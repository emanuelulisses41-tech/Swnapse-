<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nightmare Build</title>

<!-- MANIFEST -->
<link rel="manifest" href="manifest.json">

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial }
body { background:#000; color:#0f0; overflow:hidden }
canvas { display:block; background:#000 }
#menu, #final {
  position:fixed; inset:0; display:flex;
  flex-direction:column; justify-content:center; align-items:center;
  background:#000; z-index:10
}
button {
  padding:15px 30px; margin:10px;
  background:#111; color:#0f0; border:2px solid #0f0;
  font-size:18px;
}
#hud {
  position:fixed; bottom:10px; left:10px;
  font-size:14px; color:#0f0
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu">
  <h1>Nightmare Build</h1>
  <button onclick="startGame()">INICIAR</button>
</div>

<!-- FINAL SECRETO -->
<div id="final" style="display:none">
  <h1>FINAL SECRETO</h1>
  <p>VocÃª descobriu a verdade.</p>
  <button onclick="resetGame()">REINICIAR</button>
</div>

<canvas id="game"></canvas>
<div id="hud"></div>

<script>
/* =====================================================
   A â€” ENGINE + LOOP + RENDER
===================================================== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
resize();
window.addEventListener("resize", resize);

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}

let running = false;

/* =====================================================
   B â€” SISTEMA DO JOGO
===================================================== */

let GAME = {
  night: 1,
  power: 100,
  time: 0,
  camera: 0,
  animatronicX: 0,
  gameOver: false
};

let SAVE = JSON.parse(localStorage.getItem("NB_SAVE")) || {
  night: 1,
  secretEnding: false
};

function startGame(){
  document.getElementById("menu").style.display = "none";
  running = true;
  GAME.night = SAVE.night;
  loop();
}

function loop(){
  if(!running) return;
  update();
  render();
  requestAnimationFrame(loop);
}

function update(){
  GAME.time += 0.01;
  GAME.power -= 0.005;

  // IA animatrÃ´nico simples
  if(Math.random() < 0.01){
    GAME.animatronicX += 50;
  }

  if(GAME.animatronicX > canvas.width - 100){
    GAME.gameOver = true;
    running = false;
    document.getElementById("menu").style.display = "flex";
  }

  // Fim da noite
  if(GAME.time >= 6){
    nextNight();
  }
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // escritÃ³rio
  ctx.fillStyle = "#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // animatrÃ´nico
  ctx.fillStyle = "red";
  ctx.fillRect(GAME.animatronicX, canvas.height/2, 50, 100);

  document.getElementById("hud").innerHTML =
    `Noite: ${GAME.night}<br>` +
    `Energia: ${Math.floor(GAME.power)}%<br>` +
    `Hora: ${GAME.time.toFixed(2)} AM`;
}

function nextNight(){
  GAME.time = 0;
  GAME.animatronicX = 0;
  GAME.night++;
  SAVE.night = GAME.night;
  localStorage.setItem("NB_SAVE", JSON.stringify(SAVE));

  // ðŸ‘‰ CHAMA PARTE C
  checkSecretEnding();
}

/* =====================================================
   C â€” FINAL SECRETO + LORE
===================================================== */

function checkSecretEnding(){
  if(GAME.night > 5 && !SAVE.secretEnding){
    SAVE.secretEnding = true;
    localStorage.setItem("NB_SAVE", JSON.stringify(SAVE));
    triggerSecretEnding();
  }
}

function triggerSecretEnding(){
  running = false;
  document.getElementById("final").style.display = "flex";
}

function resetGame(){
  localStorage.clear();
  location.reload();
}

/* =====================================================
   SERVICE WORKER
===================================================== */

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
